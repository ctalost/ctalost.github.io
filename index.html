<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetroChat Gaming Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Palette - Premium Dark */
            --bg-body: #050505;
            --bg-glass: rgba(255, 255, 255, 0.05);
            --bg-glass-heavy: rgba(20, 20, 20, 0.75);
            --bg-glass-hover: rgba(255, 255, 255, 0.08);
            --bg-panel: rgba(30, 30, 35, 0.5);
            --bg-input: rgba(0, 0, 0, 0.3);
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #5E5CE6 0%, #BF5AF2 100%);
            --gradient-blue: linear-gradient(135deg, #0A84FF 0%, #5E5CE6 100%);
            --gradient-silver: linear-gradient(135deg, #8E8E93 0%, #636366 100%);
            --gradient-text: linear-gradient(180deg, #FFFFFF 0%, #EBEBF5 100%);
            
            /* Accents (Apple Human Interface Colors) */
            --primary: #5E5CE6; /* Indigo */
            --blue: #0A84FF;
            --cyan: #64D2FF;
            --green: #30D158;
            --orange: #FF9F0A;
            --red: #FF453A;
            --purple: #BF5AF2;
            
            /* Text */
            --text-primary: #FFFFFF;
            --text-secondary: rgba(235, 235, 245, 0.6);
            --text-tertiary: rgba(235, 235, 245, 0.3);
            
            /* Borders & Effects */
            --border: rgba(255, 255, 255, 0.08);
            --border-light: rgba(255, 255, 255, 0.12);
            --shadow-sm: 0 4px 12px rgba(0,0,0,0.2);
            --shadow-md: 0 12px 32px rgba(0,0,0,0.4);
            --shadow-lg: 0 24px 60px rgba(0,0,0,0.5);
            --glow: 0 0 20px rgba(94, 92, 230, 0.2);
            
            --radius-sm: 12px;
            --radius-md: 18px;
            --radius-lg: 24px;
            
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'SF Mono', 'Menlo', 'Monaco', 'Courier New', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-main);
            background: var(--bg-body);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.5;
            letter-spacing: -0.01em;
        }

        /* Ambient Background */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 50% 50%, rgba(94, 92, 230, 0.15), transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(10, 132, 255, 0.1), transparent 40%),
                radial-gradient(circle at 20% 80%, rgba(191, 90, 242, 0.1), transparent 40%);
            filter: blur(100px);
            z-index: -1;
            animation: aurora 25s ease-in-out infinite alternate;
        }

        @keyframes aurora {
            0% { transform: rotate(0deg) scale(1); }
            100% { transform: rotate(5deg) scale(1.1); }
        }

        /* Global UI Elements */
        svg {
            stroke-width: 1.5px;
        }
        
        button, a, input, .card, .stat-card {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-body);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s, visibility 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 24px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        /* Auth Styles */
        .auth-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .auth-card {
            background: rgba(30, 30, 35, 0.6);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-logo-icon {
            width: 64px;
            height: 64px;
            background: var(--gradient-primary);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 32px;
            box-shadow: 0 10px 30px -5px rgba(94, 92, 230, 0.4);
        }

        .auth-logo h1 {
            font-size: 24px;
            font-weight: 700;
            background: var(--gradient-text);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .auth-logo p {
            color: var(--text-secondary);
            font-size: 15px;
        }

        .auth-tabs {
            background: rgba(0, 0, 0, 0.2);
            padding: 4px;
            border-radius: 12px;
            display: flex;
            margin-bottom: 24px;
        }

        .auth-tab {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 10px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .auth-tab.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            outline: none;
        }

        .form-group input:focus {
            border-color: var(--primary);
            background: rgba(0,0,0,0.4);
            box-shadow: 0 0 0 3px rgba(94, 92, 230, 0.15);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 24px;
            border: none;
            border-radius: 14px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            letter-spacing: -0.2px;
        }

        .btn-primary {
            width: 100%;
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(94, 92, 230, 0.3);
        }

        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(94, 92, 230, 0.4);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: white;
            border: 1px solid transparent;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .btn-danger { background: rgba(255, 69, 58, 0.15); color: #FF453A; }
        .btn-danger:hover { background: rgba(255, 69, 58, 0.25); }
        
        .btn-success { background: rgba(48, 209, 88, 0.15); color: #30D158; }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
            border-radius: 10px;
        }

        .divider {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 24px 0;
            color: var(--text-tertiary);
            font-size: 13px;
        }

        .divider::before, .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .social-login {
            display: flex;
            gap: 12px;
        }

        .social-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .social-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        /* App Layout */
        .app-container {
            display: none;
            min-height: 100vh;
        }
        .app-container.active { display: block; }

        /* Navigation Rail (Floating Dock) */
        .nav-rail {
            position: fixed;
            left: 24px;
            top: 50%;
            transform: translateY(-50%);
            width: 80px;
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(50px);
            -webkit-backdrop-filter: blur(50px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
            z-index: 1000;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .nav-logo {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 10px;
            box-shadow: 0 4px 20px rgba(94, 92, 230, 0.4);
        }

        .nav-items {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            align-items: center;
        }

        .nav-icon {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
        }

        .nav-icon svg {
            width: 24px;
            height: 24px;
            stroke-width: 1.5px;
        }

        .nav-icon:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: scale(1.05);
        }

        .nav-icon.active {
            background: white;
            color: black;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.2);
        }

        .nav-tooltip {
            position: absolute;
            left: 60px;
            background: rgba(30, 30, 30, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            opacity: 0;
            pointer-events: none;
            transform: translateX(-10px);
            transition: all 0.2s;
            white-space: nowrap;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .nav-icon:hover .nav-tooltip {
            opacity: 1;
            transform: translateX(0);
        }

        .user-nav {
            margin-top: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        /* Main Stage */
        .main-stage {
            margin-left: 140px;
            margin-right: 40px;
            padding-top: 40px;
            padding-bottom: 40px;
            min-height: 100vh;
            max-width: 1600px;
        }

        .page { display: none; animation: fadeUp 0.4s ease-out; }
        .page.active { display: block; }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-header { margin-bottom: 40px; }
        .page-title { font-size: 32px; font-weight: 700; margin-bottom: 8px; letter-spacing: -1px; }
        .page-subtitle { color: var(--text-secondary); font-size: 16px; font-weight: 400; }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.15);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
        }

        .stat-card.cyan .stat-icon { background: rgba(100, 210, 255, 0.15); color: var(--cyan); }
        .stat-card.green .stat-icon { background: rgba(48, 209, 88, 0.15); color: var(--green); }
        .stat-card.orange .stat-icon { background: rgba(255, 159, 10, 0.15); color: var(--orange); }
        .stat-card.red .stat-icon { background: rgba(255, 69, 58, 0.15); color: var(--red); }

        .stat-value { font-size: 36px; font-weight: 700; letter-spacing: -1px; margin-bottom: 4px; }
        .stat-label { font-size: 13px; color: var(--text-secondary); font-weight: 500; }

        /* Cards */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
        }

        .card {
            background: var(--bg-glass-heavy);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .card-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title { font-size: 16px; font-weight: 600; }
        .card-body { padding: 24px; }

        /* Chat */
        .chat-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 24px;
            height: calc(100vh - 180px);
        }

        .chat-sidebar {
            background: var(--bg-glass-heavy);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-sidebar-header { padding: 16px; border-bottom: 1px solid var(--border); }
        .chat-search { position: relative; }
        .chat-search input {
            padding-left: 36px;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 10px;
        }
        .chat-search svg { left: 10px; width: 16px; height: 16px; }

        .chat-list { flex: 1; overflow-y: auto; padding: 12px; }

        .chat-item {
            padding: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .chat-item:hover { background: rgba(255,255,255,0.05); }

        .chat-item-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
        }

        .chat-item-info { flex: 1; min-width: 0; }
        .chat-item-name { font-size: 14px; font-weight: 600; margin-bottom: 2px; }
        .chat-item-message { font-size: 12px; color: var(--text-tertiary); }

        .chat-main {
            background: var(--bg-glass-heavy);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 16px;
            background: rgba(255,255,255,0.02);
        }
        .chat-header h3 { font-size: 16px; font-weight: 600; }

        .chat-messages {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message { display: flex; gap: 12px; max-width: 70%; }
        .message.sent { align-self: flex-end; flex-direction: row-reverse; }

        .message-content {
            background: rgba(255,255,255,0.08);
            padding: 12px 16px;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            color: var(--text-primary);
        }
        
        .message.sent .message-content {
            background: var(--primary);
            border-radius: 18px;
            border-bottom-right-radius: 4px;
        }

        .message-text { font-size: 14px; line-height: 1.4; }
        .message-time { font-size: 10px; margin-top: 4px; opacity: 0.6; }

        .chat-input {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            background: rgba(0,0,0,0.2);
        }
        
        .chat-input input {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 12px 20px;
        }

        .chat-input button {
            background: var(--primary);
            color: white;
            border-radius: 20px;
            padding: 0 24px;
            font-weight: 600;
        }

        /* Leaderboard */
        .leaderboard-table { width: 100%; border-collapse: separate; border-spacing: 0; }
        
        .leaderboard-table th {
            text-align: left;
            padding: 16px 24px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            border-bottom: 1px solid var(--border);
        }

        .leaderboard-table td {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }
        
        .leaderboard-table tr:last-child td { border-bottom: none; }
        .leaderboard-table tr:hover td { background: rgba(255,255,255,0.02); }

        .rank {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
        }
        .rank-1 { background: #FFD60A; color: black; }
        .rank-2 { background: #AEAEB2; color: black; }
        .rank-3 { background: #FF9F0A; color: white; }
        .rank-other { background: rgba(255,255,255,0.1); color: var(--text-secondary); }

        .score { font-weight: 700; color: white; font-family: var(--font-mono); }

        /* Games Grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        .game-card {
            background: var(--bg-glass-heavy);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .game-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-md);
        }

        .game-cover {
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            position: relative;
            background: var(--bg-panel);
        }
        
        .game-cover::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.6), transparent);
        }

        .game-cover.cyan { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }
        .game-cover.green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .game-cover.orange { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .game-cover.red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .game-cover.teal { background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); }
        .game-cover.pink { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }

        .game-info { padding: 24px; }
        .game-title { font-size: 18px; font-weight: 700; margin-bottom: 6px; }
        .game-desc { font-size: 13px; color: var(--text-secondary); margin-bottom: 16px; line-height: 1.4; }
        
        .game-meta { display: flex; justify-content: space-between; align-items: center; }
        .game-play-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .game-card:hover .game-play-btn { background: white; color: black; }

        /* Game Interfaces */
        .game-container {
            background: var(--bg-glass-heavy);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 40px;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        /* TTT Redesign */
        .ttt-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            max-width: 360px;
            margin: 0 auto;
        }
        .ttt-cell {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        .ttt-cell:hover { 
            background: rgba(255,255,255,0.08); 
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,255,255,0.05);
        }
        .ttt-cell svg {
            width: 60%;
            height: 60%;
            stroke-width: 2.5px;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .ttt-cell.active svg {
            opacity: 1;
            transform: scale(1);
        }
        .ttt-cell.x svg { stroke: var(--blue); filter: drop-shadow(0 0 8px rgba(10, 132, 255, 0.6)); }
        .ttt-cell.o svg { stroke: var(--red); filter: drop-shadow(0 0 8px rgba(255, 69, 58, 0.6)); }

        /* Memory Redesign */
        .memory-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            max-width: 480px;
            margin: 0 auto;
            perspective: 1000px;
        }
        .memory-card {
            aspect-ratio: 1;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
            cursor: pointer;
        }
        .memory-card:hover { transform: scale(1.05); }
        .memory-card.flipped { transform: rotateY(180deg) scale(1.05); }
        
        .memory-face {
            position: absolute;
            inset: 0;
            backface-visibility: hidden;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .memory-front {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            backdrop-filter: blur(10px);
        }
        
        .memory-back {
            background: rgba(30,30,30,0.9);
            transform: rotateY(180deg);
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(94, 92, 230, 0.2);
        }
        .memory-back svg {
            width: 50%;
            height: 50%;
            stroke: white;
            stroke-width: 2px;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
        }

        /* Snake Redesign */
        .snake-container {
            position: relative;
            display: flex;
            justify-content: center;
        }
        #snake-canvas {
            background: rgba(10, 10, 12, 0.8);
            border-radius: 24px;
            box-shadow: 0 0 40px rgba(0,0,0,0.5), inset 0 0 40px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.05);
        }
        .snake-controls {
            display: grid;
            grid-template-columns: repeat(3, 64px);
            gap: 12px;
            margin-top: 32px;
            justify-content: center;
        }
        .snake-btn {
            width: 64px;
            height: 64px;
            border-radius: 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .snake-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,255,255,0.05);
        }
        .snake-btn:active { transform: scale(0.95); }
        
        .snake-btn:nth-child(1) { grid-column: 2; }
        .snake-btn:nth-child(2) { grid-column: 1; }
        .snake-btn:nth-child(3) { grid-column: 2; }
        .snake-btn:nth-child(4) { grid-column: 3; }

        /* RPS Redesign */
        .rps-choice {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            transition: all 0.4s;
            position: relative;
        }
        .rps-choice::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--blue), var(--purple));
            opacity: 0;
            transition: opacity 0.4s;
            z-index: -1;
            filter: blur(10px);
        }
        .rps-choice.winner { 
            border-color: transparent; 
            transform: scale(1.1);
        }
        .rps-choice.winner::before { opacity: 0.6; }
        
        .rps-choice svg {
            width: 64px;
            height: 64px;
            stroke-width: 1.5px;
            color: var(--text-secondary);
        }
        .rps-choice.winner svg { color: white; }

        .rps-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .rps-btn:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.3);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .rps-btn svg { width: 32px; height: 32px; stroke-width: 1.5px; }

        /* Quiz Redesign */
        .quiz-container {
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }
        .quiz-question {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 32px;
            text-align: center;
            line-height: 1.3;
            min-height: 60px;
        }
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .quiz-option {
            padding: 18px 24px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .quiz-option:hover {
            background: rgba(255,255,255,0.08);
            transform: translateX(4px);
        }
        .quiz-option.correct {
            background: rgba(48, 209, 88, 0.2);
            border-color: var(--green);
            color: var(--green);
        }
        .quiz-option.wrong {
            background: rgba(255, 69, 58, 0.2);
            border-color: var(--red);
            color: var(--red);
        }
        
        .quiz-progress {
            display: flex;
            gap: 6px;
            margin-top: 40px;
            justify-content: center;
        }
        .quiz-dot {
            width: 8px;
            height: 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        .quiz-dot.active { width: 24px; background: white; }
        .quiz-dot.correct { background: var(--green); }
        .quiz-dot.wrong { background: var(--red); }

        /* Reaction Redesign */
        .reaction-container {
            height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .reaction-box {
            width: 100%;
            height: 100%;
            border-radius: 32px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            position: relative;
            overflow: hidden;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .reaction-box[data-state="waiting"] {
            background: rgba(255, 69, 58, 0.1);
            border-color: rgba(255, 69, 58, 0.3);
            color: var(--red);
        }
        .reaction-box[data-state="ready"] {
            background: rgba(48, 209, 88, 0.2);
            border-color: var(--green);
            color: var(--green);
            box-shadow: 0 0 50px rgba(48, 209, 88, 0.2);
            transform: scale(1.02);
        }
        
        .reaction-icon {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
        }

        /* Settings Page Styles */
        .settings-section {
            background: var(--bg-glass-heavy);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 24px;
        }

        .settings-section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }

        .setting-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .setting-item:first-child {
            padding-top: 0;
        }

        .setting-info h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .setting-info p {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 0;
        }

        .toggle {
            width: 48px;
            height: 28px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle.active {
            background: var(--primary);
        }

        .toggle.active::after {
            transform: translateX(20px);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
            color: white;
        }

        .reaction-stats {
            display: flex;
            gap: 32px;
            margin-top: 24px;
        }

        .reaction-stat {
            text-align: center;
        }

        .reaction-stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: var(--font-mono);
        }

        .reaction-stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }

        .toast {
            background: rgba(30, 30, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 280px;
            box-shadow: var(--shadow-lg);
            opacity: 1;
            transform: translateX(0);
            transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            pointer-events: all;
        }

        .toast.success { border-left: 3px solid var(--green); }
        .toast.error { border-left: 3px solid var(--red); }
        .toast.info { border-left: 3px solid var(--blue); }

        .toast-icon {
            font-size: 20px;
        }

        .toast-message {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* Room Styles */
        .room-item {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .room-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(4px);
        }

        .room-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--bg-panel);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .room-info {
            flex: 1;
        }

        .room-info h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .room-info p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .room-members {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: white;
        }

        .player-name {
            font-weight: 500;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            color: white;
            flex-shrink: 0;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal {
            background: #1c1c1e;
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 32px;
            width: 100%;
            max-width: 440px;
            transform: scale(0.95);
            transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .modal-overlay.active .modal { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 24px; }
        .modal-title { font-size: 20px; font-weight: 700; }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .nav-rail {
                position: fixed;
                width: calc(100% - 32px);
                height: 70px;
                bottom: 16px;
                top: auto;
                left: 16px;
                right: 16px;
                transform: none;
                flex-direction: row;
                justify-content: space-around;
                padding: 0 12px;
                border-radius: 20px;
                max-width: 600px;
                margin: 0 auto;
            }
            
            .nav-rail .nav-logo, .nav-rail .user-nav, .nav-rail .nav-tooltip {
                display: none;
            }
            
            .nav-items {
                flex-direction: row;
                gap: 4px;
                width: 100%;
                justify-content: space-around;
            }

            .nav-icon {
                width: 48px;
                height: 48px;
            }

            .main-stage {
                margin: 0;
                padding: 20px 16px;
                padding-bottom: 110px;
            }

            .chat-container { 
                grid-template-columns: 1fr;
                height: calc(100vh - 200px);
            }
            .chat-sidebar { display: none; }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }

            .cards-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .games-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 16px;
            }
        }

        @media (max-width: 480px) {
            .page-title {
                font-size: 24px;
            }

            .page-subtitle {
                font-size: 14px;
            }

            .nav-rail {
                width: calc(100% - 16px);
                left: 8px;
                right: 8px;
                bottom: 8px;
                height: 64px;
                padding: 0 8px;
            }

            .nav-icon {
                width: 40px;
                height: 40px;
            }

            .nav-icon svg {
                width: 20px;
                height: 20px;
            }

            .main-stage {
                padding: 16px 12px;
                padding-bottom: 90px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-value {
                font-size: 28px;
            }

            .cards-grid, .games-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .game-card {
                min-width: 0;
            }

            .ttt-board {
                gap: 12px;
                max-width: 100%;
            }

            .memory-board {
                gap: 12px;
                max-width: 100%;
            }

            #snake-canvas {
                max-width: 100%;
                width: 100% !important;
                height: auto !important;
            }

            .snake-controls {
                grid-template-columns: repeat(3, 56px);
                gap: 8px;
            }

            .snake-btn {
                width: 56px;
                height: 56px;
            }

            .rps-choice {
                width: 100px;
                height: 100px;
            }

            .rps-choice svg {
                width: 48px;
                height: 48px;
            }

            .rps-btn {
                width: 64px;
                height: 64px;
            }

            .quiz-option {
                padding: 14px 18px;
                font-size: 14px;
            }

            .reaction-box {
                font-size: 18px;
            }

            .reaction-icon {
                font-size: 36px;
            }

            .modal {
                max-width: calc(100% - 32px);
                padding: 24px;
            }

            .auth-card {
                padding: 32px 24px;
            }

            .toast-container {
                top: 16px;
                right: 16px;
                left: 16px;
            }

            .toast {
                min-width: 0;
            }

            .leaderboard-table th,
            .leaderboard-table td {
                padding: 12px 8px;
                font-size: 12px;
            }

            .chat-container {
                height: calc(100vh - 160px);
            }

            .settings-section {
                padding: 20px 16px;
            }

            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text">Initializing RetroChat...</div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-card">
            <div class="auth-logo">
                <div class="auth-logo-icon">ðŸŽ®</div>
                <h1>RetroChat</h1>
                <p>Gaming Hub & Social Platform</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Sign In</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Sign Up</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" style="display: none;" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="registerUsername" placeholder="Choose a username" required>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="registerEmail" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="registerPassword" placeholder="Create a password" required minlength="6">
                </div>
                <button type="submit" class="btn btn-primary">Create Account</button>
            </form>

            <div class="divider">or continue with</div>

            <div class="social-login">
                <button class="social-btn" onclick="signInWithGoogle()">
                    <svg width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    Google
                </button>
                <button class="social-btn" onclick="signInAsGuest()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    Guest
                </button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        
        <!-- Navigation Rail -->
        <nav class="nav-rail">
            <div class="nav-logo">ðŸŽ®</div>
            
            <div class="nav-items">
                <div class="nav-icon active" onclick="showPage('dashboard')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="7" height="7" rx="1"></rect><rect x="14" y="3" width="7" height="7" rx="1"></rect><rect x="14" y="14" width="7" height="7" rx="1"></rect><rect x="3" y="14" width="7" height="7" rx="1"></rect></svg>
                    <div class="nav-tooltip">Dashboard</div>
                </div>
                
                <div class="nav-icon" onclick="showPage('games')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 12H3"/><path d="M21 6H3"/><path d="M21 18H3"/></svg>
                    <div class="nav-tooltip">Games</div>
                </div>

                <div class="nav-icon" onclick="showPage('chat')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    <div class="nav-tooltip">Chat</div>
                </div>

                <div class="nav-icon" onclick="showPage('rooms')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                    <div class="nav-tooltip">Rooms</div>
                </div>

                <div class="nav-icon" onclick="showPage('leaderboard')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg>
                    <div class="nav-tooltip">Leaderboard</div>
                </div>
            </div>

            <div class="user-nav">
                <div class="nav-icon" onclick="showPage('settings')">
                    <div class="user-avatar" id="userAvatar" style="width: 32px; height: 32px; font-size: 12px;">U</div>
                    <div class="nav-tooltip">Profile</div>
                </div>
            </div>
        </nav>

        <!-- Main Content Stage -->
        <main class="main-stage">
            <!-- Dashboard Page -->
            <div class="page active" id="page-dashboard">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Welcome back! Here's what's happening today.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card cyan">
                        <div class="stat-header">
                            <div class="stat-icon cyan">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value" id="onlineUsers">0</div>
                        <div class="stat-label">Online Users</div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-header">
                            <div class="stat-icon green">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                                    <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                                    <path d="M4 22h16"></path>
                                    <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value" id="userScore">0</div>
                        <div class="stat-label">Your Score</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-header">
                            <div class="stat-icon orange">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <line x1="6" y1="12" x2="10" y2="12"></line>
                                    <line x1="8" y1="10" x2="8" y2="14"></line>
                                    <rect x="2" y="6" width="20" height="12" rx="2"></rect>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value" id="gamesPlayed">0</div>
                        <div class="stat-label">Games Played</div>
                    </div>
                    <div class="stat-card red">
                        <div class="stat-header">
                            <div class="stat-icon red">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value" id="messagesCount">0</div>
                        <div class="stat-label">Messages Sent</div>
                    </div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ðŸŽ® Quick Play</h3>
                        </div>
                        <div class="card-body">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <button class="btn btn-secondary" onclick="showPage('ttt')">âŒ Tic Tac Toe</button>
                                <button class="btn btn-secondary" onclick="showPage('memory')">ðŸ§  Memory</button>
                                <button class="btn btn-secondary" onclick="showPage('snake')">ðŸ Snake</button>
                                <button class="btn btn-secondary" onclick="showPage('quiz')">â“ Quiz</button>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ðŸ† Top Players</h3>
                            <button class="btn btn-small btn-secondary" onclick="showPage('leaderboard')">View All</button>
                        </div>
                        <div class="card-body" id="topPlayersPreview">
                            <p style="color: var(--text-secondary); text-align: center;">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Page -->
            <div class="page" id="page-chat">
                <div class="page-header">
                    <h1 class="page-title">Global Chat</h1>
                    <p class="page-subtitle">Chat with everyone in real-time</p>
                </div>

                <div class="chat-container">
                    <div class="chat-sidebar">
                        <div class="chat-sidebar-header">
                            <div class="chat-search">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                </svg>
                                <input type="text" placeholder="Search users...">
                            </div>
                        </div>
                        <div class="chat-list" id="onlineUsersList">
                            <p style="color: var(--text-secondary); text-align: center; padding: 20px;">Loading users...</p>
                        </div>
                    </div>
                    <div class="chat-main">
                        <div class="chat-header">
                            <div class="chat-item-avatar">ðŸŒ</div>
                            <div class="chat-header-info">
                                <h3>Global Chat</h3>
                                <p><span id="chatOnlineCount">0</span> users online</p>
                            </div>
                        </div>
                        <div class="chat-messages" id="chatMessages">
                            <p style="color: var(--text-secondary); text-align: center;">No messages yet. Start the conversation!</p>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter')sendMessage()">
                            <button onclick="sendMessage()">Send</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Private Rooms Page -->
            <div class="page" id="page-rooms">
                <div class="page-header">
                    <h1 class="page-title">Private Rooms</h1>
                    <p class="page-subtitle">Create or join private chat rooms</p>
                </div>

                <div class="rooms-container">
                    <div class="rooms-list">
                        <button class="create-room-btn" onclick="openCreateRoomModal()">
                            + Create New Room
                        </button>
                        <div id="roomsList">
                            <p style="color: var(--text-secondary); text-align: center; padding: 20px;">No rooms yet. Create one!</p>
                        </div>
                    </div>
                    <div class="room-content">
                        <div class="chat-header">
                            <div class="chat-item-avatar" id="currentRoomIcon">ðŸ”’</div>
                            <div class="chat-header-info">
                                <h3 id="currentRoomName">Select a Room</h3>
                                <p id="currentRoomMembers">0 members</p>
                            </div>
                        </div>
                        <div class="chat-messages" id="roomMessages" style="height: calc(100vh - 340px);">
                            <p style="color: var(--text-secondary); text-align: center;">Select a room to start chatting</p>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="roomChatInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter')sendRoomMessage()" disabled>
                            <button onclick="sendRoomMessage()" id="roomSendBtn" disabled>Send</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Page -->
            <div class="page" id="page-leaderboard">
                <div class="page-header">
                    <h1 class="page-title">Leaderboard</h1>
                    <p class="page-subtitle">Top players across all games</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ðŸ† Global Rankings</h3>
                        <select class="btn btn-secondary btn-small" id="leaderboardFilter" onchange="filterLeaderboard()" style="padding: 8px 12px;">
                            <option value="all">All Games</option>
                            <option value="ttt">Tic Tac Toe</option>
                            <option value="memory">Memory</option>
                            <option value="snake">Snake</option>
                            <option value="quiz">Quiz</option>
                        </select>
                    </div>
                    <div class="card-body" style="overflow-x: auto;">
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Player</th>
                                    <th>Games</th>
                                    <th>Wins</th>
                                    <th>Score</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboardBody">
                                <tr>
                                    <td colspan="5" style="text-align: center; color: var(--text-secondary);">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Games Page -->
            <div class="page" id="page-games">
                <div class="page-header">
                    <h1 class="page-title">Games</h1>
                    <p class="page-subtitle">Choose a game and start playing!</p>
                </div>

                <div class="games-grid">
                    <div class="game-card" onclick="showPage('ttt')">
                        <div class="game-cover cyan"><span>âŒâ­•</span></div>
                        <div class="game-info">
                            <h3 class="game-title">Tic Tac Toe</h3>
                            <p class="game-desc">Classic 3x3 grid game. Play against AI!</p>
                            <div class="game-meta">
                                <span class="game-players">ðŸ‘¤ vs AI</span>
                                <button class="game-play-btn">Play Now</button>
                            </div>
                        </div>
                    </div>
                    <div class="game-card" onclick="showPage('memory')">
                        <div class="game-cover green"><span>ðŸ§ </span></div>
                        <div class="game-info">
                            <h3 class="game-title">Memory Game</h3>
                            <p class="game-desc">Match pairs of cards and test your memory!</p>
                            <div class="game-meta">
                                <span class="game-players">ðŸ‘¤ 1 Player</span>
                                <button class="game-play-btn">Play Now</button>
                            </div>
                        </div>
                    </div>
                    <div class="game-card" onclick="showPage('snake')">
                        <div class="game-cover orange"><span>ðŸ</span></div>
                        <div class="game-info">
                            <h3 class="game-title">Snake</h3>
                            <p class="game-desc">Eat food, grow longer, don't hit the walls!</p>
                            <div class="game-meta">
                                <span class="game-players">ðŸ‘¤ 1 Player</span>
                                <button class="game-play-btn">Play Now</button>
                            </div>
                        </div>
                    </div>
                    <div class="game-card" onclick="showPage('quiz')">
                        <div class="game-cover red"><span>â“</span></div>
                        <div class="game-info">
                            <h3 class="game-title">Trivia Quiz</h3>
                            <p class="game-desc">Test your knowledge with random questions!</p>
                            <div class="game-meta">
                                <span class="game-players">ðŸ‘¤ 1 Player</span>
                                <button class="game-play-btn">Play Now</button>
                            </div>
                        </div>
                    </div>
                    <div class="game-card" onclick="showPage('rps')">
                        <div class="game-cover teal"><span>âœŠâœ‹âœŒï¸</span></div>
                        <div class="game-info">
                            <h3 class="game-title">Rock Paper Scissors</h3>
                            <p class="game-desc">Classic hand game against the computer!</p>
                            <div class="game-meta">
                                <span class="game-players">ðŸ‘¤ vs AI</span>
                                <button class="game-play-btn">Play Now</button>
                            </div>
                        </div>
                    </div>
                    <div class="game-card" onclick="showPage('reaction')">
                        <div class="game-cover pink"><span>âš¡</span></div>
                        <div class="game-info">
                            <h3 class="game-title">Reaction Test</h3>
                            <p class="game-desc">Test how fast your reflexes are!</p>
                            <div class="game-meta">
                                <span class="game-players">ðŸ‘¤ 1 Player</span>
                                <button class="game-play-btn">Play Now</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tic Tac Toe Page -->
            <div class="page" id="page-ttt">
                <div class="page-header">
                    <h1 class="page-title">Tic Tac Toe</h1>
                    <p class="page-subtitle">Classic X's and O's against the AI</p>
                </div>

                <div class="game-container">
                    <div class="game-header">
                        <div class="game-score-display">You: <span style="color: var(--primary);">X</span> vs AI: <span style="color: var(--danger);">O</span></div>
                        <button class="btn btn-secondary" onclick="resetTTT()">New Game</button>
                    </div>
                    <div class="ttt-board" id="tttBoard">
                        <div class="ttt-cell" onclick="playTTT(0)"></div>
                        <div class="ttt-cell" onclick="playTTT(1)"></div>
                        <div class="ttt-cell" onclick="playTTT(2)"></div>
                        <div class="ttt-cell" onclick="playTTT(3)"></div>
                        <div class="ttt-cell" onclick="playTTT(4)"></div>
                        <div class="ttt-cell" onclick="playTTT(5)"></div>
                        <div class="ttt-cell" onclick="playTTT(6)"></div>
                        <div class="ttt-cell" onclick="playTTT(7)"></div>
                        <div class="ttt-cell" onclick="playTTT(8)"></div>
                    </div>
                    <div class="ttt-status" id="tttStatus">Your turn - Click a cell to play</div>
                </div>
            </div>

            <!-- Memory Game Page -->
            <div class="page" id="page-memory">
                <div class="page-header">
                    <h1 class="page-title">Memory Game</h1>
                    <p class="page-subtitle">Match all the pairs to win!</p>
                </div>

                <div class="game-container">
                    <div class="game-header">
                        <div class="game-score-display">Pairs: <span id="memoryPairs">0</span>/8</div>
                        <button class="btn btn-secondary" onclick="initMemoryGame()">New Game</button>
                    </div>
                    <div class="memory-board" id="memoryBoard"></div>
                    <div class="memory-stats">
                        <div class="memory-stat">
                            <div class="memory-stat-value" id="memoryMoves">0</div>
                            <div class="memory-stat-label">Moves</div>
                        </div>
                        <div class="memory-stat">
                            <div class="memory-stat-value" id="memoryTime">0:00</div>
                            <div class="memory-stat-label">Time</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Snake Game Page -->
            <div class="page" id="page-snake">
                <div class="page-header">
                    <h1 class="page-title">Snake</h1>
                    <p class="page-subtitle">Eat food and grow without hitting walls!</p>
                </div>

                <div class="game-container">
                    <div class="game-header">
                        <div class="game-score-display">Score: <span id="snakeScore">0</span></div>
                        <div>High Score: <span id="snakeHighScore">0</span></div>
                        <button class="btn btn-secondary" onclick="initSnake()">New Game</button>
                    </div>
                    <div class="snake-container">
                        <canvas id="snake-canvas" width="400" height="400"></canvas>
                        <div class="snake-controls">
                            <button class="snake-btn" onclick="setSnakeDirection('up')">â†‘</button>
                            <button class="snake-btn" onclick="setSnakeDirection('left')">â†</button>
                            <button class="snake-btn" onclick="setSnakeDirection('down')">â†“</button>
                            <button class="snake-btn" onclick="setSnakeDirection('right')">â†’</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Game Page -->
            <div class="page" id="page-quiz">
                <div class="page-header">
                    <h1 class="page-title">Trivia Quiz</h1>
                    <p class="page-subtitle">Test your knowledge!</p>
                </div>

                <div class="game-container">
                    <div class="game-header">
                        <div class="game-score-display">Score: <span id="quizScore">0</span>/<span id="quizTotal">10</span></div>
                        <button class="btn btn-secondary" onclick="startQuiz()">New Quiz</button>
                    </div>
                    <div class="quiz-container" id="quizContainer">
                        <div class="quiz-question" id="quizQuestion">Click "New Quiz" to start!</div>
                        <div class="quiz-options" id="quizOptions"></div>
                        <div class="quiz-progress" id="quizProgress"></div>
                    </div>
                </div>
            </div>

            <!-- Rock Paper Scissors Page -->
            <div class="page" id="page-rps">
                <div class="page-header">
                    <h1 class="page-title">Rock Paper Scissors</h1>
                    <p class="page-subtitle">Classic game of chance!</p>
                </div>

                <div class="game-container">
                    <div class="rps-container">
                        <div class="rps-arena">
                            <div class="rps-player">
                                <div class="rps-choice" id="rpsPlayerChoice">â“</div>
                                <div class="rps-label">YOU</div>
                            </div>
                            <div class="rps-vs">VS</div>
                            <div class="rps-player">
                                <div class="rps-choice" id="rpsComputerChoice">â“</div>
                                <div class="rps-label">AI</div>
                            </div>
                        </div>
                        <div class="rps-result" id="rpsResult"></div>
                        <div class="rps-buttons">
                            <button class="rps-btn" onclick="playRPS('rock')">âœŠ</button>
                            <button class="rps-btn" onclick="playRPS('paper')">âœ‹</button>
                            <button class="rps-btn" onclick="playRPS('scissors')">âœŒï¸</button>
                        </div>
                        <div class="rps-scores">
                            <div class="rps-score">
                                <div class="rps-score-value" id="rpsPlayerScore">0</div>
                                <div class="rps-score-label">Your Wins</div>
                            </div>
                            <div class="rps-score">
                                <div class="rps-score-value" id="rpsComputerScore">0</div>
                                <div class="rps-score-label">AI Wins</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="resetRPS()" style="margin-top: 24px;">Reset Scores</button>
                    </div>
                </div>
            </div>

            <!-- Reaction Test Page -->
            <div class="page" id="page-reaction">
                <div class="page-header">
                    <h1 class="page-title">Reaction Test</h1>
                    <p class="page-subtitle">How fast are your reflexes?</p>
                </div>

                <div class="game-container">
                    <div class="reaction-container">
                        <button class="btn btn-primary" onclick="startReaction()" style="margin-bottom: 24px;">Start Test</button>
                        <div class="reaction-box" id="reactionBox" onclick="handleReactionClick()">
                            Click "Start Test" to begin
                        </div>
                        <div class="reaction-stats">
                            <div class="reaction-stat">
                                <div class="reaction-stat-value" id="reactionTime">0 ms</div>
                                <div class="reaction-stat-label">Last Time</div>
                            </div>
                            <div class="reaction-stat">
                                <div class="reaction-stat-value" id="reactionBest">---</div>
                                <div class="reaction-stat-label">Best Time</div>
                            </div>
                        </div>
                        <p id="reactionMessage" style="margin-top: 24px; color: var(--text-secondary);"></p>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page" id="page-settings">
                <div class="page-header">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-subtitle">Manage your account and preferences</p>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">ðŸ‘¤ Profile</h3>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Display Name</h4>
                            <p id="settingsDisplayName">Loading...</p>
                        </div>
                        <button class="btn btn-secondary btn-small" onclick="openEditNameModal()">Edit</button>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Email</h4>
                            <p id="settingsEmail">Loading...</p>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>User ID</h4>
                            <p id="settingsUserId" style="font-family: 'JetBrains Mono', monospace; font-size: 12px;">Loading...</p>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">ðŸ“Š Statistics</h3>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Total Score</h4>
                            <p id="statsTotalScore">0 points</p>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Games Played</h4>
                            <p id="statsGamesPlayed">0 games</p>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Messages Sent</h4>
                            <p id="statsMessages">0 messages</p>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">âš™ï¸ Preferences</h3>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Sound Effects</h4>
                            <p>Play sounds for game events</p>
                        </div>
                        <div class="toggle active" id="soundToggle" onclick="toggleSetting('sound')"></div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <h4>Notifications</h4>
                            <p>Show in-app notifications</p>
                        </div>
                        <div class="toggle active" id="notifToggle" onclick="toggleSetting('notif')"></div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">ðŸšª Account</h3>
                    <button class="btn btn-danger" onclick="signOut()" style="width: 100%;">Sign Out</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="createRoomModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Create New Room</h3>
                <button class="modal-close" onclick="closeModal('createRoomModal')">Ã—</button>
            </div>
            <form onsubmit="createRoom(event)">
                <div class="form-group">
                    <label>Room Name</label>
                    <input type="text" id="newRoomName" placeholder="Enter room name" required>
                </div>
                <div class="form-group">
                    <label>Password (Optional)</label>
                    <input type="password" id="newRoomPassword" placeholder="Leave empty for public room">
                </div>
                <button type="submit" class="btn btn-primary">Create Room</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="joinRoomModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Enter Room Password</h3>
                <button class="modal-close" onclick="closeModal('joinRoomModal')">Ã—</button>
            </div>
            <form onsubmit="joinRoomWithPassword(event)">
                <input type="hidden" id="joinRoomId">
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="joinRoomPassword" placeholder="Enter room password" required>
                </div>
                <button type="submit" class="btn btn-primary">Join Room</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="editNameModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Display Name</h3>
                <button class="modal-close" onclick="closeModal('editNameModal')">Ã—</button>
            </div>
            <form onsubmit="updateDisplayName(event)">
                <div class="form-group">
                    <label>New Display Name</label>
                    <input type="text" id="newDisplayName" placeholder="Enter new name" required>
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAE75AlF1oDc_02lue7A7rtZ74x0y3eQLI",
            authDomain: "retrochat-795b4.firebaseapp.com",
            databaseURL: "https://retrochat-795b4-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "retrochat-795b4",
            storageBucket: "retrochat-795b4.firebasestorage.app",
            messagingSenderId: "588960494570",
            appId: "1:588960494570:web:702a85c54f386e626fb893",
            measurementId: "G-PLF4ETNC5Z"
        };

        // Initialize Firebase with error handling
        let auth, db;
        try {
            if (typeof firebase !== 'undefined') {
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.database();
            }
        } catch (error) {
            console.warn('Firebase initialization failed:', error);
        }

        // Global Variables
        let currentUser = null;
        let currentRoom = null;
        let unsubscribers = [];

        // Auth Functions
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'login') {
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
            } else {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'block';
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            if (!auth) {
                showToast('Authentication not available', 'error');
                return;
            }
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
                showToast('Welcome back!', 'success');
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            if (!auth || !db) {
                showToast('Authentication not available', 'error');
                return;
            }
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: username });
                
                await db.ref('users/' + userCredential.user.uid).set({
                    username: username,
                    email: email,
                    score: 0,
                    gamesPlayed: 0,
                    wins: 0,
                    messagesSent: 0,
                    createdAt: Date.now()
                });

                showToast('Account created successfully!', 'success');
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        async function signInWithGoogle() {
            if (!auth || !db) {
                showToast('Authentication not available', 'error');
                return;
            }
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await auth.signInWithPopup(provider);
                
                const userRef = db.ref('users/' + result.user.uid);
                const snapshot = await userRef.once('value');
                
                if (!snapshot.exists()) {
                    await userRef.set({
                        username: result.user.displayName,
                        email: result.user.email,
                        score: 0,
                        gamesPlayed: 0,
                        wins: 0,
                        messagesSent: 0,
                        createdAt: Date.now()
                    });
                }

                showToast('Welcome!', 'success');
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        async function signInAsGuest() {
            if (!auth || !db) {
                showToast('Authentication not available', 'error');
                return;
            }
            try {
                const result = await auth.signInAnonymously();
                const guestName = 'Guest_' + Math.floor(Math.random() * 10000);
                
                await result.user.updateProfile({ displayName: guestName });
                
                await db.ref('users/' + result.user.uid).set({
                    username: guestName,
                    score: 0,
                    gamesPlayed: 0,
                    wins: 0,
                    messagesSent: 0,
                    createdAt: Date.now(),
                    isGuest: true
                });

                showToast('Signed in as guest!', 'success');
            } catch (error) {
                showToast(error.message, 'error');
            }
        }

        function signOut() {
            if (!auth) return;
            if (currentUser && db) {
                db.ref('presence/' + currentUser.uid).remove();
            }
            auth.signOut();
            showToast('Signed out successfully', 'info');
        }

        // Auth State Observer
        // Add fallback to hide loading screen even if Firebase fails
        setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('hidden');
        }, 1000);

        // Check if Firebase is loaded before trying to use it
        if (typeof firebase !== 'undefined' && firebase.auth) {
            auth.onAuthStateChanged(async (user) => {
                document.getElementById('loadingScreen').classList.add('hidden');
                
                if (user) {
                    currentUser = user;
                    document.getElementById('authContainer').style.display = 'none';
                    document.getElementById('appContainer').classList.add('active');
                    initializeApp();
                } else {
                    currentUser = null;
                    document.getElementById('authContainer').style.display = 'flex';
                    document.getElementById('appContainer').classList.remove('active');
                    unsubscribers.forEach(unsub => unsub());
                    unsubscribers = [];
                }
            });
        } else {
            // Firebase not available - enable demo mode button
            console.warn('Firebase not available. Demo mode enabled.');
            document.getElementById('loadingScreen').classList.add('hidden');
            
            // Add demo mode button
            const authCard = document.querySelector('.auth-card');
            if (authCard && !document.getElementById('demoModeBtn')) {
                const demoBtn = document.createElement('button');
                demoBtn.id = 'demoModeBtn';
                demoBtn.className = 'btn btn-primary';
                demoBtn.style.marginTop = '16px';
                demoBtn.textContent = 'ðŸŽ® Enter Demo Mode';
                demoBtn.onclick = enterDemoMode;
                authCard.appendChild(demoBtn);
            }
        }

        function enterDemoMode() {
            // Create a demo user
            currentUser = {
                uid: 'demo-user-' + Date.now(),
                displayName: 'Demo User',
                email: null,
                isAnonymous: true
            };
            
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            initializeApp();
            showToast('Welcome to Demo Mode! Games work, but data is not saved.', 'info');
        }

        // App Initialization
        function initializeApp() {
            updateUserUI();
            if (db) {
                setupPresence();
                loadDashboardData();
                setupChatListener();
                loadLeaderboard();
                loadRooms();
            }
            initMemoryGame();
            if (db) {
                loadSettings(); // Load settings on app init
            }
        }

        function updateUserUI() {
            const displayName = currentUser ? (currentUser.displayName || 'User') : 'Demo User';
            const userNameEl = document.getElementById('userName');
            const userAvatarEl = document.getElementById('userAvatar');
            const settingsDisplayNameEl = document.getElementById('settingsDisplayName');
            const settingsEmailEl = document.getElementById('settingsEmail');
            const settingsUserIdEl = document.getElementById('settingsUserId');
            
            if (userNameEl) userNameEl.textContent = displayName;
            if (userAvatarEl) userAvatarEl.textContent = displayName.charAt(0).toUpperCase();
            if (settingsDisplayNameEl) settingsDisplayNameEl.textContent = displayName;
            if (settingsEmailEl) settingsEmailEl.textContent = currentUser ? (currentUser.email || 'Anonymous') : 'Demo Mode';
            if (settingsUserIdEl) settingsUserIdEl.textContent = currentUser ? currentUser.uid : 'demo-user';
        }

        function setupPresence() {
            if (!db || !currentUser) return;
            const presenceRef = db.ref('presence/' + currentUser.uid);
            const connectedRef = db.ref('.info/connected');

            connectedRef.on('value', (snap) => {
                if (snap.val() === true) {
                    presenceRef.set({
                        username: currentUser.displayName || 'User',
                        online: true,
                        lastSeen: firebase.database.ServerValue.TIMESTAMP
                    });
                    presenceRef.onDisconnect().remove();
                }
            });

            db.ref('presence').on('value', (snap) => {
                const users = snap.val() || {};
                const count = Object.keys(users).length;
                const onlineUsersEl = document.getElementById('onlineUsers');
                const chatOnlineCountEl = document.getElementById('chatOnlineCount');
                if (onlineUsersEl) onlineUsersEl.textContent = count;
                if (chatOnlineCountEl) chatOnlineCountEl.textContent = count;
                updateOnlineUsersList(users);
            });
        }

        function updateOnlineUsersList(users) {
            const list = document.getElementById('onlineUsersList');
            if (!list) return;
            
            let html = '';
            
            Object.entries(users).forEach(([uid, user]) => {
                html += `
                    <div class="chat-item">
                        <div class="chat-item-avatar">${(user.username || 'U').charAt(0).toUpperCase()}</div>
                        <div class="chat-item-info">
                            <div class="chat-item-name">${escapeHtml(user.username || 'User')}</div>
                            <div class="chat-item-message" style="color: var(--secondary);">â— Online</div>
                        </div>
                    </div>
                `;
            });

            list.innerHTML = html || '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No users online</p>';
        }

        async function loadDashboardData() {
            if (!db || !currentUser) return;
            const userRef = db.ref('users/' + currentUser.uid);
            userRef.on('value', (snap) => {
                const data = snap.val() || {};
                const userScoreEl = document.getElementById('userScore');
                const gamesPlayedEl = document.getElementById('gamesPlayed');
                const messagesCountEl = document.getElementById('messagesCount');
                const statsTotalScoreEl = document.getElementById('statsTotalScore');
                const statsGamesPlayedEl = document.getElementById('statsGamesPlayed');
                const statsMessagesEl = document.getElementById('statsMessages');
                
                if (userScoreEl) userScoreEl.textContent = data.score || 0;
                if (gamesPlayedEl) gamesPlayedEl.textContent = data.gamesPlayed || 0;
                if (messagesCountEl) messagesCountEl.textContent = data.messagesSent || 0;
                if (statsTotalScoreEl) statsTotalScoreEl.textContent = (data.score || 0) + ' points';
                if (statsGamesPlayedEl) statsGamesPlayedEl.textContent = (data.gamesPlayed || 0) + ' games';
                if (statsMessagesEl) statsMessagesEl.textContent = (data.messagesSent || 0) + ' messages';
            });

            db.ref('users').orderByChild('score').limitToLast(3).on('value', (snap) => {
                const users = [];
                snap.forEach(child => {
                    users.push({ id: child.key, ...child.val() });
                });
                users.reverse();

                let html = '';
                users.forEach((user, i) => {
                    html += `
                        <div style="display: flex; align-items: center; gap: 12px; padding: 10px 0; ${i < users.length - 1 ? 'border-bottom: 1px solid var(--border);' : ''}">
                            <div class="rank rank-${i + 1}" style="width: 32px; height: 32px; font-size: 12px;">${i + 1}</div>
                            <div style="flex: 1; font-weight: 500;">${escapeHtml(user.username || 'User')}</div>
                            <div style="font-weight: 700; color: var(--primary-light);">${user.score || 0}</div>
                        </div>
                    `;
                });
                const topPlayersEl = document.getElementById('topPlayersPreview');
                if (topPlayersEl) {
                    topPlayersEl.innerHTML = html || '<p style="color: var(--text-secondary); text-align: center;">No players yet</p>';
                }
            });
        }

        // Navigation
        function showPage(pageId) {
            // Remove active class from all pages and nav icons
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-icon').forEach(n => n.classList.remove('active'));
            
            // Show the selected page
            const targetPage = document.getElementById('page-' + pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // Highlight the active nav icon based on onclick attribute
            document.querySelectorAll('.nav-icon').forEach(nav => {
                if (nav.onclick?.toString().includes("'" + pageId + "'") || 
                    nav.onclick?.toString().includes('"' + pageId + '"')) {
                    nav.classList.add('active');
                }
            });

            // Specific game initializations on page show
            if (pageId === 'snake') initSnake();
            if (pageId === 'memory') initMemoryGame();
            if (pageId === 'ttt') renderTTT(); // Ensure TTT board is rendered
            if (pageId === 'quiz') renderQuizQuestion(); // Render current quiz state
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Chat
        function setupChatListener() {
            if (!db) return;
            const chatRef = db.ref('globalChat').orderByChild('timestamp').limitToLast(100);
            const chatListener = chatRef.on('value', (snap) => {
                const messages = [];
                snap.forEach(child => {
                    messages.push({ id: child.key, ...child.val() });
                });
                renderChatMessages(messages);
            });
            unsubscribers.push(() => chatRef.off('value', chatListener)); // Store listener to remove later
        }

        function renderChatMessages(messages) {
            const container = document.getElementById('chatMessages');
            
            if (!container) return;
            
            if (messages.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No messages yet. Start the conversation!</p>';
                return;
            }

            let html = '';
            messages.forEach(msg => {
                const isSent = currentUser && msg.userId === currentUser.uid;
                const time = new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                html += `
                    <div class="message ${isSent ? 'sent' : ''}">
                        <div class="message-avatar">${(msg.username || 'U').charAt(0).toUpperCase()}</div>
                        <div class="message-content">
                            ${!isSent ? `<div style="font-size: 12px; font-weight: 600; margin-bottom: 4px; color: var(--primary-light);">${escapeHtml(msg.username)}</div>` : ''}
                            <div class="message-text">${escapeHtml(msg.text)}</div>
                            <div class="message-time">${time}</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            container.scrollTop = container.scrollHeight;
        }

        async function sendMessage() {
            if (!db || !currentUser) {
                showToast('Chat not available', 'error');
                return;
            }
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            
            if (!text) return;

            try {
                await db.ref('globalChat').push({
                    userId: currentUser.uid,
                    username: currentUser.displayName || 'User',
                    text: text,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });

                await db.ref('users/' + currentUser.uid + '/messagesSent').transaction(count => (count || 0) + 1);
                input.value = '';
            } catch (error) {
                showToast('Failed to send message', 'error');
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Private Rooms
        function loadRooms() {
            if (!db) return;
            const roomsRef = db.ref('rooms');
            const roomsListener = roomsRef.on('value', (snap) => {
                const rooms = [];
                snap.forEach(child => {
                    rooms.push({ id: child.key, ...child.val() });
                });
                renderRoomsList(rooms);
            });
            unsubscribers.push(() => roomsRef.off('value', roomsListener));
        }

        function renderRoomsList(rooms) {
            const container = document.getElementById('roomsList');
            
            if (!container) return;
            
            if (rooms.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No rooms yet. Create one!</p>';
                return;
            }

            let html = '';
            rooms.forEach(room => {
                html += `
                    <div class="room-item" onclick="joinRoom('${room.id}', ${room.hasPassword || false})">
                        <div class="room-icon">${room.hasPassword ? 'ðŸ”’' : 'ðŸ”“'}</div>
                        <div class="room-info">
                            <h4>${escapeHtml(room.name)}</h4>
                            <p>by ${escapeHtml(room.creatorName || 'Unknown')}</p>
                        </div>
                        <div class="room-members">
                            <span>${room.memberCount || 0}</span> ðŸ‘¥
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function openCreateRoomModal() {
            document.getElementById('createRoomModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function createRoom(e) {
            e.preventDefault();
            const name = document.getElementById('newRoomName').value.trim();
            const password = document.getElementById('newRoomPassword').value;

            try {
                const roomRef = await db.ref('rooms').push({
                    name: name,
                    creatorId: currentUser.uid,
                    creatorName: currentUser.displayName || 'User',
                    hasPassword: !!password,
                    password: password || null,
                    memberCount: 1,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                });

                await db.ref('roomMembers/' + roomRef.key + '/' + currentUser.uid).set({
                    username: currentUser.displayName || 'User',
                    joinedAt: firebase.database.ServerValue.TIMESTAMP
                });

                closeModal('createRoomModal');
                document.getElementById('newRoomName').value = '';
                document.getElementById('newRoomPassword').value = '';
                showToast('Room created!', 'success');
                joinRoom(roomRef.key, false);
            } catch (error) {
                showToast('Failed to create room', 'error');
            }
        }

        async function joinRoom(roomId, hasPassword) {
            // Check if the user is already in the room to avoid re-joining and duplicating listeners
            if (currentRoom === roomId) return;

            // Clean up previous room listeners
            unsubscribers.forEach(unsub => unsub());
            unsubscribers = [];

            if (hasPassword) {
                const memberSnap = await db.ref('roomMembers/' + roomId + '/' + currentUser.uid).once('value');
                if (!memberSnap.exists()) {
                    document.getElementById('joinRoomId').value = roomId;
                    document.getElementById('joinRoomModal').classList.add('active');
                    return;
                }
            }

            currentRoom = roomId;

            await db.ref('roomMembers/' + roomId + '/' + currentUser.uid).set({
                username: currentUser.displayName || 'User',
                joinedAt: firebase.database.ServerValue.TIMESTAMP
            });

            const membersSnap = await db.ref('roomMembers/' + roomId).once('value');
            const memberCount = Object.keys(membersSnap.val() || {}).length;
            await db.ref('rooms/' + roomId + '/memberCount').set(memberCount);

            const roomSnap = await db.ref('rooms/' + roomId).once('value');
            const room = roomSnap.val();

            document.getElementById('currentRoomName').textContent = room.name;
            document.getElementById('currentRoomMembers').textContent = memberCount + ' members';
            document.getElementById('currentRoomIcon').textContent = room.hasPassword ? 'ðŸ”’' : 'ðŸ”“';
            document.getElementById('roomChatInput').disabled = false;
            document.getElementById('roomSendBtn').disabled = false;

            const roomMessagesRef = db.ref('roomMessages/' + roomId).orderByChild('timestamp').limitToLast(100);
            const roomMessagesListener = roomMessagesRef.on('value', (snap) => {
                const messages = [];
                snap.forEach(child => {
                    messages.push({ id: child.key, ...child.val() });
                });
                renderRoomMessages(messages);
            });
            unsubscribers.push(() => roomMessagesRef.off('value', roomMessagesListener));
        }

        async function joinRoomWithPassword(e) {
            e.preventDefault();
            const roomId = document.getElementById('joinRoomId').value;
            const password = document.getElementById('joinRoomPassword').value;

            const roomSnap = await db.ref('rooms/' + roomId).once('value');
            const room = roomSnap.val();

            if (room && room.password === password) {
                closeModal('joinRoomModal');
                document.getElementById('joinRoomPassword').value = '';
                await joinRoom(roomId, false); // Join without password check now
            } else {
                showToast('Incorrect password', 'error');
            }
        }

        function renderRoomMessages(messages) {
            const container = document.getElementById('roomMessages');
            
            if (!container) return;
            
            if (messages.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No messages in this room yet.</p>';
                return;
            }

            let html = '';
            messages.forEach(msg => {
                const isSent = currentUser && msg.userId === currentUser.uid;
                const time = new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                html += `
                    <div class="message ${isSent ? 'sent' : ''}">
                        <div class="message-avatar">${(msg.username || 'U').charAt(0).toUpperCase()}</div>
                        <div class="message-content">
                            ${!isSent ? `<div style="font-size: 12px; font-weight: 600; margin-bottom: 4px; color: var(--primary-light);">${escapeHtml(msg.username)}</div>` : ''}
                            <div class="message-text">${escapeHtml(msg.text)}</div>
                            <div class="message-time">${time}</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            container.scrollTop = container.scrollHeight;
        }

        async function sendRoomMessage() {
            if (!currentRoom) return;
            
            const input = document.getElementById('roomChatInput');
            const text = input.value.trim();
            
            if (!text) return;

            try {
                await db.ref('roomMessages/' + currentRoom).push({
                    userId: currentUser.uid,
                    username: currentUser.displayName || 'User',
                    text: text,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                input.value = '';
            } catch (error) {
                showToast('Failed to send message', 'error');
            }
        }

        // Leaderboard
        function loadLeaderboard() {
            if (!db) return;
            const leaderboardRef = db.ref('users').orderByChild('score');
            const leaderboardListener = leaderboardRef.on('value', (snap) => {
                const users = [];
                snap.forEach(child => {
                    users.push({ id: child.key, ...child.val() });
                });
                users.reverse();
                renderLeaderboard(users);
            });
            unsubscribers.push(() => leaderboardRef.off('value', leaderboardListener));
        }

        function renderLeaderboard(users) {
            const tbody = document.getElementById('leaderboardBody');
            
            if (!tbody) return;
            
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-secondary);">No players yet</td></tr>';
                return;
            }

            let html = '';
            users.slice(0, 50).forEach((user, i) => {
                const rankClass = i < 3 ? `rank-${i + 1}` : 'rank-other';
                html += `
                    <tr>
                        <td><div class="rank ${rankClass}">${i + 1}</div></td>
                        <td>
                            <div class="player-info">
                                <div class="player-avatar">${(user.username || 'U').charAt(0).toUpperCase()}</div>
                                <div class="player-name">${escapeHtml(user.username || 'User')}</div>
                            </div>
                        </td>
                        <td>${user.gamesPlayed || 0}</td>
                        <td>${user.wins || 0}</td>
                        <td><span class="score">${user.score || 0}</span></td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        function filterLeaderboard() {
            loadLeaderboard();
        }

        // Tic Tac Toe
        let tttBoard = ['', '', '', '', '', '', '', '', ''];
        let tttGameOver = false;

        function playTTT(index) {
            if (tttBoard[index] || tttGameOver) return;

            tttBoard[index] = 'X';
            renderTTT();

            if (checkTTTWinner('X')) {
                document.getElementById('tttStatus').textContent = 'ðŸŽ‰ You Win!';
                tttGameOver = true;
                addScore(50);
                incrementGames();
                incrementWins();
                return;
            }

            if (tttBoard.every(cell => cell)) {
                document.getElementById('tttStatus').textContent = "ðŸ¤ It's a Draw!";
                tttGameOver = true;
                addScore(10);
                incrementGames();
                return;
            }

            setTimeout(aiMoveTTT, 300);
        }

        function aiMoveTTT() {
            const emptyCells = tttBoard.map((c, i) => c === '' ? i : null).filter(i => i !== null);
            if (emptyCells.length === 0) return;

            // Simple AI: Try to win, block, or random
            let move = findWinningMove('O') || findWinningMove('X') || emptyCells[Math.floor(Math.random() * emptyCells.length)];
            
            tttBoard[move] = 'O';
            renderTTT();

            if (checkTTTWinner('O')) {
                document.getElementById('tttStatus').textContent = 'ðŸ˜” AI Wins!';
                tttGameOver = true;
                incrementGames();
                return;
            }

            if (tttBoard.every(cell => cell)) {
                document.getElementById('tttStatus').textContent = "ðŸ¤ It's a Draw!";
                tttGameOver = true;
                addScore(10);
                incrementGames();
                return;
            }

            document.getElementById('tttStatus').textContent = 'Your turn - Click a cell';
        }

        function findWinningMove(player) {
            const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            for (let line of lines) {
                const [a, b, c] = line;
                const cells = [tttBoard[a], tttBoard[b], tttBoard[c]];
                if (cells.filter(c => c === player).length === 2 && cells.includes('')) {
                    return line[cells.indexOf('')];
                }
            }
            return null;
        }

        function checkTTTWinner(player) {
            const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            return lines.some(([a,b,c]) => tttBoard[a] === player && tttBoard[b] === player && tttBoard[c] === player);
        }

        function renderTTT() {
            const cells = document.querySelectorAll('.ttt-cell');
            cells.forEach((cell, i) => {
                cell.innerHTML = ''; // Clear existing
                cell.className = 'ttt-cell';
                
                if (tttBoard[i] === 'X') {
                    cell.classList.add('x', 'active');
                    cell.innerHTML = '<svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';
                } else if (tttBoard[i] === 'O') {
                    cell.classList.add('o', 'active');
                    cell.innerHTML = '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle></svg>';
                }
            });
        }

        function resetTTT() {
            tttBoard = ['', '', '', '', '', '', '', '', ''];
            tttGameOver = false;
            renderTTT();
            document.getElementById('tttStatus').textContent = 'Your turn - Click a cell to play';
        }

        // Memory Game
        // SVG Icons for memory cards
        const memoryIcons = [
            '<path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>', // Stack
            '<circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line>', // Smile
            '<path d="M12 2a10 10 0 1 0 10 10H12V2z"></path>', // Pie
            '<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>', // Star
            '<rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>', // Insta
            '<path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>', // Message
            '<path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path>', // Bell
            '<path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="15"></line>' // Feather
        ];
        
        let memoryCards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let memoryMoves = 0;
        let memoryTimer = null;
        let memorySeconds = 0;

        function initMemoryGame() {
            const shuffled = [...memoryIcons, ...memoryIcons].sort(() => Math.random() - 0.5);
            memoryCards = shuffled.map((icon, i) => ({ id: i, icon, flipped: false, matched: false }));
            flippedCards = [];
            matchedPairs = 0;
            memoryMoves = 0;
            memorySeconds = 0;
            
            clearInterval(memoryTimer);
            memoryTimer = setInterval(() => {
                memorySeconds++;
                document.getElementById('memoryTime').textContent = formatTime(memorySeconds);
            }, 1000);

            renderMemory();
            document.getElementById('memoryPairs').textContent = '0';
            document.getElementById('memoryMoves').textContent = '0';
            document.getElementById('memoryTime').textContent = '0:00';
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s.toString().padStart(2, '0')}`;
        }

        function renderMemory() {
            const board = document.getElementById('memoryBoard');
            board.innerHTML = memoryCards.map((card, i) => `
                <div id="card-${i}" class="memory-card ${card.flipped ? 'flipped' : ''} ${card.matched ? 'matched' : ''}" onclick="flipCard(${i})">
                    <div class="memory-face memory-front">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width: 24px; opacity: 0.5;">
                            <circle cx="12" cy="12" r="1"></circle>
                            <circle cx="19" cy="12" r="1"></circle>
                            <circle cx="5" cy="12" r="1"></circle>
                        </svg>
                    </div>
                    <div class="memory-face memory-back">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                            ${card.icon}
                        </svg>
                    </div>
                </div>
            `).join('');
        }

        function flipCard(index) {
            const card = memoryCards[index];
            if (card.flipped || card.matched || flippedCards.length >= 2) return;

            // Flip the card visually and in state
            card.flipped = true;
            document.getElementById(`card-${index}`).classList.add('flipped');
            
            flippedCards.push(index);

            if (flippedCards.length === 2) {
                memoryMoves++;
                document.getElementById('memoryMoves').textContent = memoryMoves;

                const [first, second] = flippedCards;
                // FIX: use .icon instead of .emoji
                if (memoryCards[first].icon === memoryCards[second].icon) {
                    memoryCards[first].matched = true;
                    memoryCards[second].matched = true;
                    
                    // Update visual for match (optional, or just keep flipped)
                    document.getElementById(`card-${first}`).classList.add('matched');
                    document.getElementById(`card-${second}`).classList.add('matched');
                    
                    matchedPairs++;
                    document.getElementById('memoryPairs').textContent = matchedPairs;
                    flippedCards = [];
                    
                    if (matchedPairs === 8) {
                        clearInterval(memoryTimer);
                        const score = Math.max(200 - memoryMoves * 5 - memorySeconds, 50);
                        addScore(score);
                        incrementGames();
                        incrementWins();
                        showToast(`ðŸŽ‰ You won! Score: ${score}`, 'success');
                    }
                } else {
                    // No match
                    setTimeout(() => {
                        memoryCards[first].flipped = false;
                        memoryCards[second].flipped = false;
                        
                        document.getElementById(`card-${first}`).classList.remove('flipped');
                        document.getElementById(`card-${second}`).classList.remove('flipped');
                        
                        flippedCards = [];
                    }, 1000);
                }
            }
        }

        // Snake Game (Redesigned)
        let snake = [];
        let food = {};
        let snakeDirection = 'right';
        let snakeGame = null;
        let snakeScore = 0;
        let snakeHighScore = parseInt(localStorage.getItem('snakeHighScore')) || 0;
        let snakeCtx = null;
        const gridSize = 20;
        const canvasSize = 400;

        function initSnake() {
            const canvas = document.getElementById('snake-canvas');
            snakeCtx = canvas.getContext('2d');
            
            snake = [{ x: 5, y: 10 }, { x: 4, y: 10 }, { x: 3, y: 10 }];
            snakeDirection = 'right';
            snakeScore = 0;
            document.getElementById('snakeScore').textContent = snakeScore;
            document.getElementById('snakeHighScore').textContent = snakeHighScore;
            
            spawnFood();
            
            if (snakeGame) clearInterval(snakeGame);
            snakeGame = setInterval(gameLoop, 100);
        }

        function spawnFood() {
            food = {
                x: Math.floor(Math.random() * (canvasSize / gridSize)),
                y: Math.floor(Math.random() * (canvasSize / gridSize))
            };
        }

        function gameLoop() {
            const head = { ...snake[0] };
            
            switch (snakeDirection) {
                case 'up': head.y--; break;
                case 'down': head.y++; break;
                case 'left': head.x--; break;
                case 'right': head.x++; break;
            }

            if (head.x < 0 || head.x >= canvasSize / gridSize || 
                head.y < 0 || head.y >= canvasSize / gridSize ||
                snake.some(seg => seg.x === head.x && seg.y === head.y)) {
                endSnakeGame();
                return;
            }

            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                snakeScore += 10;
                document.getElementById('snakeScore').textContent = snakeScore;
                spawnFood();
            } else {
                snake.pop();
            }

            drawSnake();
        }

        function drawSnake() {
            // Clear & Draw Background
            snakeCtx.clearRect(0, 0, canvasSize, canvasSize);
            
            // Draw subtle dot grid
            snakeCtx.fillStyle = 'rgba(255, 255, 255, 0.05)';
            for(let x=0; x<canvasSize; x+=gridSize) {
                for(let y=0; y<canvasSize; y+=gridSize) {
                    snakeCtx.beginPath();
                    snakeCtx.arc(x + gridSize/2, y + gridSize/2, 1, 0, Math.PI*2);
                    snakeCtx.fill();
                }
            }

            // Draw Food (Pulsing Orb)
            snakeCtx.shadowBlur = 15;
            snakeCtx.shadowColor = '#FF453A';
            snakeCtx.fillStyle = '#FF453A';
            snakeCtx.beginPath();
            snakeCtx.arc(
                food.x * gridSize + gridSize / 2,
                food.y * gridSize + gridSize / 2,
                gridSize / 3,
                0,
                Math.PI * 2
            );
            snakeCtx.fill();
            snakeCtx.shadowBlur = 0;

            // Draw Snake (Smooth Neon)
            snake.forEach((seg, i) => {
                const isHead = i === 0;
                snakeCtx.shadowBlur = 10;
                snakeCtx.shadowColor = isHead ? '#BF5AF2' : '#5E5CE6';
                snakeCtx.fillStyle = isHead ? '#BF5AF2' : '#5E5CE6';
                
                const x = seg.x * gridSize + 2;
                const y = seg.y * gridSize + 2;
                const size = gridSize - 4;
                const radius = isHead ? 6 : 4;
                
                // Draw rounded rectangle manually for compatibility
                snakeCtx.beginPath();
                snakeCtx.moveTo(x + radius, y);
                snakeCtx.lineTo(x + size - radius, y);
                snakeCtx.quadraticCurveTo(x + size, y, x + size, y + radius);
                snakeCtx.lineTo(x + size, y + size - radius);
                snakeCtx.quadraticCurveTo(x + size, y + size, x + size - radius, y + size);
                snakeCtx.lineTo(x + radius, y + size);
                snakeCtx.quadraticCurveTo(x, y + size, x, y + size - radius);
                snakeCtx.lineTo(x, y + radius);
                snakeCtx.quadraticCurveTo(x, y, x + radius, y);
                snakeCtx.closePath();
                snakeCtx.fill();
            });
            snakeCtx.shadowBlur = 0;
        }

        function setSnakeDirection(dir) {
            const opposites = { up: 'down', down: 'up', left: 'right', right: 'left' };
            if (dir !== opposites[snakeDirection]) {
                snakeDirection = dir;
            }
        }

        function endSnakeGame() {
            clearInterval(snakeGame);
            snakeGame = null;

            if (snakeScore > snakeHighScore) {
                snakeHighScore = snakeScore;
                localStorage.setItem('snakeHighScore', snakeHighScore);
                document.getElementById('snakeHighScore').textContent = snakeHighScore;
                showToast('ðŸŽ‰ New High Score: ' + snakeHighScore, 'success');
            }

            addScore(snakeScore);
            incrementGames();
            if (snakeScore >= 50) incrementWins();

            showToast('Game Over! Score: ' + snakeScore, 'info');
        }

        document.addEventListener('keydown', (e) => {
            const keyMap = {
                'ArrowUp': 'up',
                'ArrowDown': 'down',
                'ArrowLeft': 'left',
                'ArrowRight': 'right',
                'w': 'up',
                's': 'down',
                'a': 'left',
                'd': 'right'
            };
            if (keyMap[e.key]) {
                e.preventDefault();
                setSnakeDirection(keyMap[e.key]);
            }
        });

        // Quiz Game
        const quizQuestions = [
            { q: "What is the capital of France?", options: ["London", "Berlin", "Paris", "Madrid"], answer: 2 },
            { q: "Which planet is known as the Red Planet?", options: ["Venus", "Mars", "Jupiter", "Saturn"], answer: 1 },
            { q: "What is the largest mammal?", options: ["Elephant", "Blue Whale", "Giraffe", "Hippopotamus"], answer: 1 },
            { q: "Who painted the Mona Lisa?", options: ["Van Gogh", "Picasso", "Da Vinci", "Michelangelo"], answer: 2 },
            { q: "What is the chemical symbol for gold?", options: ["Go", "Gd", "Au", "Ag"], answer: 2 },
            { q: "Which country has the most population?", options: ["USA", "India", "China", "Russia"], answer: 2 },
            { q: "What year did World War II end?", options: ["1943", "1944", "1945", "1946"], answer: 2 },
            { q: "What is the largest ocean?", options: ["Atlantic", "Indian", "Arctic", "Pacific"], answer: 3 },
            { q: "Who wrote Romeo and Juliet?", options: ["Dickens", "Shakespeare", "Hemingway", "Twain"], answer: 1 },
            { q: "What is the speed of light?", options: ["300,000 km/s", "150,000 km/s", "500,000 km/s", "100,000 km/s"], answer: 0 },
            { q: "Which element has atomic number 1?", options: ["Helium", "Oxygen", "Hydrogen", "Carbon"], answer: 2 },
            { q: "What is the largest continent?", options: ["Africa", "Europe", "Asia", "America"], answer: 2 },
            { q: "Who invented the telephone?", options: ["Edison", "Tesla", "Bell", "Marconi"], answer: 2 },
            { q: "What is the currency of Japan?", options: ["Yuan", "Won", "Yen", "Ringgit"], answer: 2 },
            { q: "How many bones in human body?", options: ["186", "206", "226", "246"], answer: 1 }
        ];

        let currentQuiz = [];
        let quizIndex = 0;
        let quizScore = 0;
        let quizAnswered = false;

        function startQuiz() {
            currentQuiz = [...quizQuestions].sort(() => Math.random() - 0.5).slice(0, 10);
            quizIndex = 0;
            quizScore = 0;
            quizAnswered = false;
            document.getElementById('quizScore').textContent = '0';
            document.getElementById('quizTotal').textContent = currentQuiz.length;
            renderQuizQuestion();
        }

        function renderQuizQuestion() {
            if (currentQuiz.length === 0) return;

            if (quizIndex >= currentQuiz.length) {
                const container = document.getElementById('quizContainer');
                const percentage = Math.round((quizScore / currentQuiz.length) * 100);
                const scorePoints = quizScore * 20;
                
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 0;">
                        <div style="font-size: 64px; margin-bottom: 24px;">ðŸŽ‰</div>
                        <h2 style="font-size: 28px; margin-bottom: 16px;">Quiz Complete!</h2>
                        <p style="font-size: 20px; color: var(--text-secondary); margin-bottom: 8px;">
                            You scored ${quizScore} out of ${currentQuiz.length}
                        </p>
                        <p style="font-size: 32px; font-weight: 800; color: var(--primary-light);">
                            ${percentage}%
                        </p>
                        <p style="color: var(--secondary); margin-top: 16px;">+${scorePoints} points</p>
                        <button class="btn btn-primary" onclick="startQuiz()" style="margin-top: 24px;">
                            Play Again
                        </button>
                    </div>
                `;

                addScore(scorePoints);
                incrementGames();
                if (percentage >= 70) incrementWins();
                return;
            }

            const question = currentQuiz[quizIndex];
            quizAnswered = false;

            document.getElementById('quizQuestion').textContent = question.q;
            
            const optionsHtml = question.options.map((opt, i) => `
                <div class="quiz-option" onclick="answerQuiz(${i})" data-index="${i}">
                    ${opt}
                </div>
            `).join('');
            document.getElementById('quizOptions').innerHTML = optionsHtml;

            let dotsHtml = '';
            for (let i = 0; i < currentQuiz.length; i++) {
                let dotClass = 'quiz-dot';
                if (i === quizIndex) dotClass += ' active';
                dotsHtml += `<div class="${dotClass}"></div>`;
            }
            document.getElementById('quizProgress').innerHTML = dotsHtml;
        }

        function answerQuiz(index) {
            if (quizAnswered) return;
            quizAnswered = true;

            const question = currentQuiz[quizIndex];
            const options = document.querySelectorAll('.quiz-option');

            options.forEach((opt, i) => {
                if (i === question.answer) {
                    opt.classList.add('correct');
                } else if (i === index && index !== question.answer) {
                    opt.classList.add('wrong');
                }
            });

            if (index === question.answer) {
                quizScore++;
                document.getElementById('quizScore').textContent = quizScore;
            }

            const dots = document.querySelectorAll('.quiz-dot');
            dots[quizIndex].classList.remove('active');
            dots[quizIndex].classList.add(index === question.answer ? 'correct' : 'wrong');

            setTimeout(() => {
                quizIndex++;
                renderQuizQuestion();
            }, 1500);
        }

        // Rock Paper Scissors (Redesigned)
        let rpsPlayerScore = 0;
        let rpsComputerScore = 0;
        
        const rpsIcons = {
            rock: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>',
            paper: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
            scissors: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="6" cy="6" r="3"></circle><circle cx="6" cy="18" r="3"></circle><line x1="20" y1="4" x2="8.12" y2="15.88"></line><line x1="14.47" y1="14.48" x2="20" y2="20"></line><line x1="8.12" y1="8.12" x2="12" y2="12"></line></svg>',
            question: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>'
        };

        function playRPS(playerChoice) {
            const choices = ['rock', 'paper', 'scissors'];
            const computerChoice = choices[Math.floor(Math.random() * 3)];

            // Update UI with SVG icons
            document.getElementById('rpsPlayerChoice').innerHTML = rpsIcons[playerChoice];
            document.getElementById('rpsComputerChoice').innerHTML = rpsIcons[computerChoice];
            
            // Remove previous winner classes
            document.getElementById('rpsPlayerChoice').classList.remove('winner');
            document.getElementById('rpsComputerChoice').classList.remove('winner');

            let result = '';
            let playerWin = false;
            let computerWin = false;

            if (playerChoice === computerChoice) {
                result = "ðŸ¤ It's a Tie!";
                addScore(5);
            } else if (
                (playerChoice === 'rock' && computerChoice === 'scissors') ||
                (playerChoice === 'paper' && computerChoice === 'rock') ||
                (playerChoice === 'scissors' && computerChoice === 'paper')
            ) {
                result = 'ðŸŽ‰ You Win!';
                rpsPlayerScore++;
                addScore(15);
                playerWin = true;
            } else {
                result = 'ðŸ˜” You Lose!';
                rpsComputerScore++;
                computerWin = true;
            }
            
            // Add winner effects
            if (playerWin) document.getElementById('rpsPlayerChoice').classList.add('winner');
            if (computerWin) document.getElementById('rpsComputerChoice').classList.add('winner');

            document.getElementById('rpsResult').textContent = result;
            document.getElementById('rpsPlayerScore').textContent = rpsPlayerScore;
            document.getElementById('rpsComputerScore').textContent = rpsComputerScore;
        }

        function resetRPS() {
            rpsPlayerScore = 0;
            rpsComputerScore = 0;
            document.getElementById('rpsPlayerScore').textContent = '0';
            document.getElementById('rpsComputerScore').textContent = '0';
            document.getElementById('rpsPlayerChoice').innerHTML = rpsIcons.question;
            document.getElementById('rpsComputerChoice').innerHTML = rpsIcons.question;
            document.getElementById('rpsResult').textContent = '';
            document.getElementById('rpsPlayerChoice').classList.remove('winner');
            document.getElementById('rpsComputerChoice').classList.remove('winner');
        }

        // Reaction Time (Redesigned)
        let reactionState = 'idle';
        let reactionTimeout = null;
        let reactionStartTime = 0;
        let reactionBest = Infinity;

        function startReaction() {
            const box = document.getElementById('reactionBox');
            box.setAttribute('data-state', 'waiting');
            box.innerHTML = '<div class="reaction-icon">ðŸ›‘</div><div>Wait for Green...</div>';
            
            reactionState = 'waiting';
            document.getElementById('reactionTime').textContent = '0 ms';
            document.getElementById('reactionMessage').textContent = 'Wait for it...';

            const delay = Math.random() * 3000 + 2000;
            reactionTimeout = setTimeout(() => {
                box.setAttribute('data-state', 'ready');
                box.innerHTML = '<div class="reaction-icon">âš¡</div><div>CLICK NOW!</div>';
                reactionState = 'ready';
                reactionStartTime = Date.now();
            }, delay);
        }

        function handleReactionClick() {
            const box = document.getElementById('reactionBox');

            if (reactionState === 'waiting') {
                clearTimeout(reactionTimeout);
                box.removeAttribute('data-state');
                box.innerHTML = '<div class="reaction-icon">âš ï¸</div><div>Too Early!</div><div style="font-size: 14px; margin-top: 8px; opacity: 0.7;">Click to try again</div>';
                document.getElementById('reactionMessage').textContent = 'Too early!';
                reactionState = 'idle';
            } else if (reactionState === 'ready') {
                const reactionTime = Date.now() - reactionStartTime;
                document.getElementById('reactionTime').textContent = reactionTime + ' ms';

                if (reactionTime < reactionBest) {
                    reactionBest = reactionTime;
                    document.getElementById('reactionBest').textContent = reactionTime + ' ms';
                    document.getElementById('reactionMessage').textContent = 'ðŸŽ‰ New Best!';
                    showToast('New best reaction time: ' + reactionTime + 'ms!', 'success');
                } else {
                    document.getElementById('reactionMessage').textContent = 'Good job!';
                }

                const score = Math.max(100 - Math.floor(reactionTime / 5), 10);
                addScore(score);
                incrementGames();

                box.removeAttribute('data-state');
                box.innerHTML = `<div class="reaction-icon">â±ï¸</div><div>${reactionTime}ms</div><div style="font-size: 14px; margin-top: 8px; opacity: 0.7;">Click to play again</div>`;
                reactionState = 'idle';
            } else if (reactionState === 'idle') {
                startReaction();
            }
        }

        // Utility Functions
        async function addScore(points) {
            if (!currentUser || !db) return;
            try {
                await db.ref('users/' + currentUser.uid + '/score').transaction(score => (score || 0) + points);
            } catch (e) {
                console.error('Failed to update score:', e);
            }
        }

        async function incrementGames() {
            if (!currentUser || !db) return;
            try {
                await db.ref('users/' + currentUser.uid + '/gamesPlayed').transaction(count => (count || 0) + 1);
            } catch (e) {
                console.error('Failed to update games:', e);
            }
        }

        async function incrementWins() {
            if (!currentUser || !db) return;
            try {
                await db.ref('users/' + currentUser.uid + '/wins').transaction(count => (count || 0) + 1);
            } catch (e) {
                console.error('Failed to update wins:', e);
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = { success: 'âœ…', error: 'âŒ', info: 'â„¹ï¸' };

            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <span class="toast-message">${message}</span>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        function openEditNameModal() {
            if (!currentUser) return;
            const newDisplayNameEl = document.getElementById('newDisplayName');
            if (newDisplayNameEl) {
                newDisplayNameEl.value = currentUser.displayName || '';
            }
            document.getElementById('editNameModal').classList.add('active');
        }

        async function updateDisplayName(e) {
            e.preventDefault();
            if (!currentUser || !db) {
                showToast('Profile update not available in demo mode', 'error');
                return;
            }
            const newName = document.getElementById('newDisplayName').value.trim();

            try {
                await currentUser.updateProfile({ displayName: newName });
                await db.ref('users/' + currentUser.uid + '/username').set(newName);
                
                updateUserUI();
                closeModal('editNameModal');
                showToast('Display name updated!', 'success');
            } catch (error) {
                showToast('Failed to update name', 'error');
            }
        }

        function toggleSetting(setting) {
            const toggle = document.getElementById(setting + 'Toggle');
            toggle.classList.toggle('active');
            localStorage.setItem(setting + 'Enabled', toggle.classList.contains('active'));
        }

        function loadSettings() {
            const soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
            const notifEnabled = localStorage.getItem('notifEnabled') !== 'false';

            if (!soundEnabled) document.getElementById('soundToggle').classList.remove('active');
            else document.getElementById('soundToggle').classList.add('active');

            if (!notifEnabled) document.getElementById('notifToggle').classList.remove('active');
            else document.getElementById('notifToggle').classList.add('active');
        }

        // Initial load of settings when DOM is ready
        document.addEventListener('DOMContentLoaded', loadSettings);

        document.addEventListener('visibilitychange', () => {
            if (currentUser && db) {
                if (document.hidden) {
                    db.ref('presence/' + currentUser.uid + '/online').set(false);
                } else {
                    db.ref('presence/' + currentUser.uid + '/online').set(true);
                }
            }
        });

        window.addEventListener('beforeunload', () => {
            if (currentUser && db) {
                db.ref('presence/' + currentUser.uid).remove();
            }
        });

        console.log('%cðŸŽ® RetroChat Gaming Hub', 'font-size: 24px; font-weight: bold; color: #06b6d4;');
        console.log('%cWelcome to the console! Have fun gaming!', 'font-size: 14px; color: #9ca3af;');
    </script>
</body>
</html>
